(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{384:function(t,a,s){"use strict";s.r(a);var v=s(10),_=Object(v.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"api-签名与鉴权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api-签名与鉴权"}},[t._v("#")]),t._v(" API 签名与鉴权")]),t._v(" "),a("p",[t._v("部分客户端专用的 rest api 存在基于 sign 的鉴权，需要使用规定的"),a("code",[t._v("appkey")]),t._v("及其对应的"),a("code",[t._v("appsec")]),t._v("与原始请求参数进行签名计算")]),t._v(" "),a("p",[t._v("不同"),a("code",[t._v("appkey")]),t._v("对应不同的 app (如客户端、概念版、必剪、漫画、bililink等)")]),t._v(" "),a("p",[t._v("不同平台同 app 也会存在不同的 "),a("code",[t._v("appkey")]),t._v("(如安卓端、ios端、TV端等)")]),t._v(" "),a("p",[t._v("同平台同 app 下不同功能也会存在不同的 "),a("code",[t._v("appkey")]),t._v("（如登录专用、取流专用等）")]),t._v(" "),a("p",[a("strong",[t._v("appkey与appsec一一对应")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#API%E7%AD%BE%E5%90%8D%E7%9A%84%E8%AE%A1%E7%AE%97%E6%96%B9%E5%BC%8F"}},[t._v("API签名的计算方式")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%B7%B2%E7%9F%A5%E7%9A%84APPKey"}},[t._v("已知的APPKey")])])]),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"api签名的计算方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api签名的计算方式"}},[t._v("#")]),t._v(" API签名的计算方式")]),t._v(" "),a("p",[t._v("首先为参数中添加"),a("code",[t._v("appkey")]),t._v("字段，然后按照参数的 key 重新排序，再将重排序后的参数使用 url query 格式序列化拼接与该 appkey 相对应的 appsec (盐值) 进行"),a("strong",[t._v("md5 hash计算")]),t._v("（32位小写），该 hash 便是 API 签名")]),t._v(" "),a("p",[t._v("为参数尾部增添"),a("code",[t._v("sign")]),t._v("字段，它的值为上一步计算所得的 hash，一并作为表单提交")]),t._v(" "),a("p",[a("strong",[t._v("实例：")])]),t._v(" "),a("p",[t._v("使用 appkey = "),a("code",[t._v("1d8b6e7d45233436")]),t._v(", appsec = "),a("code",[t._v("560c52ccd288fed045859ed18bffd973")]),t._v(" 对如下 "),a("code",[t._v("params")]),t._v(" 参数进行签名")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" hashlib\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" urllib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parse\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appsign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" appkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" appsec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'为请求参数进行 api 签名'")]),t._v("\n    params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'appkey'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" appkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    params "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("dict")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("sorted")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重排序参数 key")]),t._v("\n    query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" urllib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urlencode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 序列化参数")]),t._v("\n    sign "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hashlib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("md5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("appsec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hexdigest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 计算 api 签名")]),t._v("\n    params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("update"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sign'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("sign"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" params\n\nappkey "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1d8b6e7d45233436'")]),t._v("\nappsec "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'560c52ccd288fed045859ed18bffd973'")]),t._v("\nparams "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("114514")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'str'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1919810'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'いいよ，こいよ'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nsigned_params "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" appsign"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" appkey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" appsec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nquery "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" urllib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urlencode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("signed_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("signed_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("输出以下内容，分别是进行 api 签名后参数的 dict 以及 url query 格式")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("{'appkey': '1d8b6e7d45233436', 'id': 114514, 'str': '1919810', 'test': 'いいよ，こいよ', 'sign': '01479cf20504d865519ac50f33ba3a7d'}\nappkey=1d8b6e7d45233436&id=114514&str=1919810&test=%E3%81%84%E3%81%84%E3%82%88%EF%BC%8C%E3%81%93%E3%81%84%E3%82%88&sign=01479cf20504d865519ac50f33ba3a7d\n")])])]),a("h2",{attrs:{id:"已知的appkey"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#已知的appkey"}},[t._v("#")]),t._v(" 已知的APPKey")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("appkey")]),t._v(" "),a("th",[t._v("appsec（sign盐值）")]),t._v(" "),a("th",[t._v("平台")]),t._v(" "),a("th",[t._v("应用")]),t._v(" "),a("th",[t._v("备注")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("07da50c9a0bf829f")]),t._v(" "),a("td",[t._v("25bdede4e1581c836cab73a48790ca6e")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("概念版")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("1d8b6e7d45233436")]),t._v(" "),a("td",[t._v("560c52ccd288fed045859ed18bffd973")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("客户端")]),t._v(" "),a("td",[t._v("一般用途")])]),t._v(" "),a("tr",[a("td",[t._v("178cf125136ca8ea")]),t._v(" "),a("td",[t._v("34381a26236dd1171185c0beb042e1c6")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("概念版")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("27eb53fc9058f8c3")]),t._v(" "),a("td",[t._v("c2ed53a74eeefe3cf99fbd01d8c9c375")]),t._v(" "),a("td",[t._v("ios")]),t._v(" "),a("td",[t._v("客户端")]),t._v(" "),a("td",[t._v("一般用途")])]),t._v(" "),a("tr",[a("td",[t._v("37207f2beaebf8d7")]),t._v(" "),a("td",[t._v("e988e794d4d4b6dd43bc0e89d6e90c43")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("biliLink")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("4409e2ce8ffd12b8")]),t._v(" "),a("td",[t._v("59b43e04ad6965f34319062b478f83dd")]),t._v(" "),a("td",[t._v("TV")]),t._v(" "),a("td",[t._v("客户端")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("57263273bc6b67f6")]),t._v(" "),a("td",[t._v("a0488e488d1567960d3a765e8d129f90")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("客户端")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("8d23902c1688a798")]),t._v(" "),a("td",[t._v("710f0212e62bd499b8d3ac6e1db9302a")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("车机版")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("5dce947fe22167f9")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("必剪")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("7d336ec01856996b")]),t._v(" "),a("td",[t._v("a1ce6983bc89e20a36c37f40c4f1a0dd")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("概念版")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("85eb6835b0a1034e")]),t._v(" "),a("td",[t._v("2ad42749773c441109bdc0191257a664")]),t._v(" "),a("td"),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("8e16697a1b4f8121")]),t._v(" "),a("td",[t._v("f5dd03b752426f2e623d7badb28d190a")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("国际版")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("aae92bc66f3edfab")]),t._v(" "),a("td",[t._v("af125a0d5279fd576c1b4418a3e8276d")]),t._v(" "),a("td",[t._v("PC")]),t._v(" "),a("td",[t._v("投稿工具")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("ae57252b0c09105d")]),t._v(" "),a("td",[t._v("c75875c596a69eb55bd119e74b07cfe3")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("国际版")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("bb3101000e232e27")]),t._v(" "),a("td",[t._v("36efcfed79309338ced0380abd824ac1")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("国际版")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("bca7e84c2d947ac6")]),t._v(" "),a("td",[t._v("60698ba2f68e01ce44738920a0ffe768")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("客户端")]),t._v(" "),a("td",[t._v("登录专用")])]),t._v(" "),a("tr",[a("td",[t._v("cc578d267072c94d")]),t._v(" "),a("td",[t._v("ffb6bb4c4edae2566584dbcacfc6a6ad")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("轻视频")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("cc8617fd6961e070")]),t._v(" "),a("td",[t._v("3131924b941aac971e45189f265262be")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("漫画")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("iVGUTjsxvpLeuDCf")]),t._v(" "),a("td",[t._v("aHRmhWMLkdeMuILqORnYZocwMBpMEOdt")]),t._v(" "),a("td",[t._v("安卓")]),t._v(" "),a("td",[t._v("客户端")]),t._v(" "),a("td",[t._v("取流专用")])]),t._v(" "),a("tr",[a("td",[t._v("YvirImLGlLANCLvM")]),t._v(" "),a("td",[t._v("JNlZNgfNGKZEpaDTkCdPQVXntXhuiJEM")]),t._v(" "),a("td",[t._v("ios")]),t._v(" "),a("td",[t._v("客户端")]),t._v(" "),a("td",[t._v("取流专用")])])])])])}),[],!1,null,null,null);a.default=_.exports}}]);